<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Joins ENM from several partitions, creating a model per algorithm — final_model • modleR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Joins ENM from several partitions, creating a model per algorithm — final_model" />
<meta property="og:description" content="This function reads the models generated either by do_any or
do_many (i.e. one model per partition per algorithm) and
summarizes them into a final model for each species-algorithm combination.
These final models may be created from the raw continuous models, the binary
models or the &quot;cut&quot; models (see do_any). They may use all
partitions or select only partitions with performance metrics above a defined
value (parameters select_partitions, select_par and
select_par_val). The function can also calculate weighted means of the
partitions (selected or not) using a performance statistic (passed to
argument weight_par). After selecting and/or weighing each partition,
a series of output can be created, see which_models for details about
the final outputs available. Uncertainty taken as ranges between partitions may
also be calculated. Analogous to no silver bullets in correlative
ecological niche modeling, no method for evaluating and selecting partitions
is always better and these are only a subset of the possibilities. The user
should choose how to create the final model based on their assumptions. We
simply recommend to focus on statistical clarity rather than significance
 (Dushoff et al. 2019)
." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">modleR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/modleR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Joins ENM from several partitions, creating a model per algorithm</h1>
    
    <div class="hidden name"><code>final_model.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function reads the models generated either by <code>do_any</code> or
<code>do_many</code> (i.e. one model per partition per algorithm) and
summarizes them into a final model for each species-algorithm combination.
These final models may be created from the raw continuous models, the binary
models or the "cut" models (see <code>do_any</code>). They may use all
partitions or select only partitions with performance metrics above a defined
value (parameters <code>select_partitions</code>, <code>select_par</code> and
<code>select_par_val</code>). The function can also calculate weighted means of the
partitions (selected or not) using a performance statistic (passed to
argument <code>weight_par</code>). After selecting and/or weighing each partition,
a series of output can be created, see <code>which_models</code> for details about
the final outputs available. Uncertainty taken as ranges between partitions may
also be calculated. Analogous to <em>no silver bullets in correlative
ecological niche modeling</em>, no method for evaluating and selecting partitions
is always better and these are only a subset of the possibilities. The user
should choose how to create the final model based on their assumptions. We
simply recommend to focus on statistical clarity rather than significance
 (Dushoff et al. 2019)
.</p>
    </div>

    <pre class="usage"><span class='fu'>final_model</span>(<span class='no'>species_name</span>, <span class='kw'>algorithms</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>select_partitions</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>select_par</span> <span class='kw'>=</span> <span class='st'>"TSS"</span>, <span class='kw'>select_par_val</span> <span class='kw'>=</span> <span class='fl'>0.7</span>, <span class='kw'>weight_par</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>cut_level</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"spec_sens"</span>), <span class='kw'>scale_models</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>consensus_level</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>models_dir</span> <span class='kw'>=</span> <span class='st'>"./models"</span>,
  <span class='kw'>final_dir</span> <span class='kw'>=</span> <span class='st'>"final_models"</span>, <span class='kw'>proj_dir</span> <span class='kw'>=</span> <span class='st'>"present"</span>,
  <span class='kw'>which_models</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"raw_mean"</span>), <span class='kw'>uncertainty</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>write_final</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>species_name</th>
      <td><p>A character string with the species name. Because species
name will be used as a directory name, avoid non-ASCII characters, spaces and
punctuation marks.
Recommendation is to adopt "Genus_species" format. See names in
<code>example_occs</code> as an example</p></td>
    </tr>
    <tr>
      <th>algorithms</th>
      <td><p>Character vector specifying which algorithms will be
processed. Note that it can have length &gt; 1, ex. <code><a href='https://rdrr.io/r/base/c.html'>c("bioclim", "rf")</a></code>.
Defaults to NULL: if no name is given it will process all algorithms present
in the evaluation files</p></td>
    </tr>
    <tr>
      <th>select_partitions</th>
      <td><p>Logical. If TRUE only partitions above a particular
threshold value are selected</p></td>
    </tr>
    <tr>
      <th>select_par</th>
      <td><p>Which performance statistic should be used to select the
partitions. Defaults to NULL but either <code>"AUC"</code> or <code>"TSS"</code> can be
used</p></td>
    </tr>
    <tr>
      <th>select_par_val</th>
      <td><p>Performance metric value to select partitions</p></td>
    </tr>
    <tr>
      <th>weight_par</th>
      <td><p>Which performance statistic should be used to weigh the
partitions. Defaults to NULL but either <code><a href='https://rdrr.io/r/base/c.html'>c("AUC", "TSS")</a></code> can be used</p></td>
    </tr>
    <tr>
      <th>cut_level</th>
      <td><p>Which selecting threshold will be used to cut the mean
models. Default is set to "<code>spec_sens</code>" but any <span class="pkg">dismo</span> threshold (see
function <code><a href='https://rdrr.io/pkg/dismo/man/threshold.html'>threshold</a></code>) can be used: "<code>kappa</code>", "<code>no_omission</code>",
 "<code>prevalence</code>", "<code>equal_sens_spec</code>", "<code>sensitivity</code>"</p></td>
    </tr>
    <tr>
      <th>scale_models</th>
      <td><p>Logical. Whether input models should be scaled between 0
and 1</p></td>
    </tr>
    <tr>
      <th>consensus_level</th>
      <td><p>Which proportion of binary models will be kept when creating <code>bin_consensus</code></p></td>
    </tr>
    <tr>
      <th>models_dir</th>
      <td><p>Character. Folder path where the input files are located</p></td>
    </tr>
    <tr>
      <th>final_dir</th>
      <td><p>Character. Name of the folder to save the output files.
A subfolder will be created, defaults to "final_model"</p></td>
    </tr>
    <tr>
      <th>proj_dir</th>
      <td><p>Character. The name of the subfolder with the projection.
Defaults to "present" but can be set according to the other projections (i.e.
to execute the function in projected models)</p></td>
    </tr>
    <tr>
      <th>which_models</th>
      <td><p>Which <code>final_model</code> will be used? Currently it can
be:</p><dl class='dl-horizontal'>
  <dt><code>raw_mean</code></dt><dd><p>Continuous model generated by the mean of the raw
  models (scale from 0 to 1)</p></dd>
  <dt><code>raw_mean_th</code></dt><dd><p>Cuts the <code>raw_mean</code> by the mean of the
  thresholds that maximize the selected evaluation metric (e.g. TSS
  (<code>spec_sens</code>) to make a binary model</p></dd>
   <dt><code>raw_mean_cut</code></dt><dd><p>Recovers <code>raw_mean</code> values above the mean
   threshold that maximizes the selected evaluation metric (e.g. TSS
   (<code>spec_sens</code>) or other <span class="pkg">dismo</span> thresholds). Generates a
   continuous model</p></dd>
  <dt><code>bin_mean</code></dt><dd><p>The mean of the selected binary models. Generates a
  model in a discrete scale (0 to 1 in 1/n intervals where n is the number of retained models)</p></dd>
  <dt><code>bin_consensus</code></dt><dd><p>The binary consensus from <code>bin_mean</code>.
  Parameter <code>consensus_level</code> must be defined, 0.5 means a majority
  consensus</p></dd>
  <dt><code>cut_mean</code></dt><dd><p>The mean of the selected cut models. Values below
  the thresholds are down-weighted by zeros</p></dd>

</dl></td>
    </tr>
    <tr>
      <th>uncertainty</th>
      <td><p>Whether an uncertainty map, measured as range (max-min)
should be calculated</p></td>
    </tr>
    <tr>
      <th>write_final</th>
      <td><p>Logical. If <code>TRUE</code>, writes png files of the final
models</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other parameters from <code><a href='https://rdrr.io/pkg/raster/man/writeRaster.html'>writeRaster</a></code>, especially <code>overwrite = TRUE</code>, when needed</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns a data frame with final statistics of the partitions included in the final model</p>
<p>Writes on disk a set of ecological niche models (.tif files) in the <code>final_dir</code> subfolder</p>
<p>If <code>write_final = TRUE</code> writes .png figures
 in the <code>final_dir</code> subfolder</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Dushoff J, Kain MP, Bolker BM (2019).
&#8220;I Can See Clearly Now: Reinterpreting Statistical Significance.&#8221;
<em>Methods in Ecology and Evolution</em>, <b>10</b>(6), 756-759.
ISSN 2041-210X, doi: <a href='http://doi.org/10.1111/2041-210X.13159'>10.1111/2041-210X.13159</a>
.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://rdrr.io/pkg/dismo/man/threshold.html'>threshold</a></code>  in <span class="pkg">dismo</span> package</p>
<p><code><a href='https://rdrr.io/pkg/raster/man/writeRaster.html'>writeRaster</a></code>  in <span class="pkg">raster</span> package</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># run setup_sdmdata</span>
<span class='no'>sp</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>example_occs</span>)[<span class='fl'>1</span>]
<span class='no'>sp_coord</span> <span class='kw'>&lt;-</span> <span class='no'>example_occs</span><span class='kw'>[[</span><span class='fl'>1</span>]]
<span class='no'>sp_setup</span> <span class='kw'>&lt;-</span> <span class='fu'>setup_sdmdata</span>(<span class='kw'>species_name</span> <span class='kw'>=</span> <span class='no'>sp</span>,
                          <span class='kw'>occurrences</span> <span class='kw'>=</span> <span class='no'>sp_coord</span>,
                          <span class='kw'>predictors</span> <span class='kw'>=</span> <span class='no'>example_vars</span>)</div><div class='output co'>#&gt; <span class='message'>metadata file found, checking metadata </span></div><div class='output co'>#&gt; <span class='message'>same metadata, no need to run data partition</span></div><div class='input'>
<span class='co'># run do_any</span>
<span class='no'>sp_bioclim</span> <span class='kw'>&lt;-</span> <span class='fu'>do_any</span>(<span class='kw'>species_name</span> <span class='kw'>=</span> <span class='no'>sp</span>,
                     <span class='kw'>predictors</span> <span class='kw'>=</span> <span class='no'>example_vars</span>,
                     <span class='kw'>algorithm</span> <span class='kw'>=</span> <span class='st'>"bioclim"</span>)</div><div class='output co'>#&gt; <span class='message'>bioclim </span></div><div class='output co'>#&gt; <span class='message'>Abarema_langsdorffii bioclim run number 1 part. nb. 1 </span></div><div class='output co'>#&gt; <span class='message'>fitting models</span></div><div class='output co'>#&gt; <span class='message'>projecting the models</span></div><div class='output co'>#&gt; <span class='message'>evaluating the models</span></div><div class='output co'>#&gt; <span class='message'>writing evaluation tables</span></div><div class='output co'>#&gt; <span class='message'>writing raster files</span></div><div class='input'>
<span class='co'># run final_model</span>
<span class='no'>sp_final</span> <span class='kw'>&lt;-</span> <span class='fu'>final_model</span>(<span class='kw'>species_name</span> <span class='kw'>=</span> <span class='no'>sp</span>,
                        <span class='kw'>algorithms</span> <span class='kw'>=</span> <span class='st'>"bioclim"</span>,
                        <span class='kw'>select_partitions</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
                        <span class='kw'>select_par</span> <span class='kw'>=</span> <span class='st'>"TSS"</span>,
                        <span class='kw'>select_par_val</span> <span class='kw'>=</span> <span class='fl'>0</span>,
                        <span class='kw'>which_models</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"bin_consensus"</span>),
                        <span class='kw'>consensus_level</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
                        <span class='kw'>overwrite</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; [1] "Mon Nov  4 13:51:37 2019"
#&gt; Abarema_langsdorffii 
#&gt; Reading evaluation files for Abarema_langsdorffii in present 
#&gt; Extracting data for Abarema_langsdorffii bioclim 
#&gt; Reading models from .tif files 
#&gt; selecting partitions for Abarema_langsdorffii bioclim </div><div class='output co'>#&gt; <span class='message'>1 / 1 partitions will be used for Abarema_langsdorffii bioclim </span></div><div class='output co'>#&gt; <span class='warning'>Warning: when only one partition is selected some final models</span>
#&gt; <span class='warning'>                          are identical </span></div><div class='output co'>#&gt; Standardizing models from 0 to 1 
#&gt; selected final models for Abarema_langsdorffii bioclim DONE </div><div class='output co'>#&gt; <span class='message'>writing models bioclim bin_consensus </span></div><div class='output co'>#&gt; [1] "DONE bioclim !"</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Andrea Sánchez-Tapia, Sara Mortara, Diogo Rocha, Felipe Barros, Guilherme Gall.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


